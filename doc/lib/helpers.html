<!DOCTYPE html><html lang="en"><head><title>lib/helpers</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="lib/helpers"><meta name="groc-project-path" content="src/lib/helpers.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/lib/helpers.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="utilitaires">Utilitaires</h1></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> moment <span class="hljs-keyword">from</span> <span class="hljs-string">'moment'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Calage de la bibliothèque <a href="http://momentjs.com/">Moment.js</a> en français.</p></div></div><div class="code"><div class="wrapper">moment.locale(<span class="hljs-string">'fr'</span>)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Formatage de date de façon “pratique”.</p>
<p>Si un format est passé (<code>String</code>), il est utilisé directement
(c’est le cas pour le titre de <code>TrackerScreen</code> par exemple, qui
utilise le code de format local semi-long <code>&#39;LL&#39;</code>), sinon on
utilise des textes spéciaux pour aujourd’hui, hier et avant-hier,
et des formats longs pour toute date autre.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatDate</span> (<span class="hljs-params">date, format</span>) </span>{
  date = moment(date)
  <span class="hljs-keyword">if</span> (format) {
    <span class="hljs-keyword">return</span> date.format(format)
  }
  <span class="hljs-keyword">if</span> (date.isSame(moment(), <span class="hljs-string">'day'</span>)) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'Aujourd’hui'</span>
  }
  <span class="hljs-keyword">if</span> (date.isSame(moment().subtract(<span class="hljs-number">1</span>, <span class="hljs-string">'day'</span>), <span class="hljs-string">'day'</span>)) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'Hier'</span>
  }
  <span class="hljs-keyword">if</span> (date.isSame(moment().subtract(<span class="hljs-number">2</span>, <span class="hljs-string">'days'</span>), <span class="hljs-string">'day'</span>)) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'Avant-hier'</span>
  }
  <span class="hljs-keyword">return</span> date.format(<span class="hljs-string">'dddd D MMMM YYYY'</span>)
}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Détermine le rapport entre l’avancée de la journée (0h–minuit) et le taux de complétion d’une tâche
ou d’un ensemble de tâches.  Si on est bien dans les temps, ce rapport doit approcher de 1 (si on est
en avance, il dépasse 1, si on est bien à la bourre, il est vers 0.5 voire en-dessous).</p>
<p>Utilisé notamment pour les codes couleurs des jauges, mais aussi d’une manière générale pour déterminer
si on est en retard à des moments donnés de la journée.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCompletionRatio</span> (<span class="hljs-params">current, target</span>) </span>{
  <span class="hljs-keyword">const</span> todaysRatio = moment().diff(moment().startOf(<span class="hljs-string">'day'</span>), <span class="hljs-string">'day'</span>, <span class="hljs-literal">true</span>)
  <span class="hljs-keyword">const</span> targetRatio = target &gt; <span class="hljs-number">0</span> ? current / target : <span class="hljs-number">1</span>

  <span class="hljs-keyword">return</span> todaysRatio &gt; <span class="hljs-number">0</span> ? targetRatio / todaysRatio : <span class="hljs-number">1</span>
}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Calcule les totaux de progression et d’objectifs sur la journée, pour déterminer ensuite par exemple
le taux global de progression, ou le retard potentiel (avec des données résultats permettant de l’affiche
de façon explicite).</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDayCounts</span> (<span class="hljs-params">todaysProgress, goals</span>) </span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Le plus intéressant ici, c&#39;est le parcours unique de la liste en effectuant
un <code>reduce</code> composite sur deux compteurs : celui de nos progressions, et celui
de nos objectifs quotidiens.</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-keyword">const</span> [totalProgress, totalTarget] = goals.reduce((acc, { id, target }) =&gt; {
    acc[<span class="hljs-number">0</span>] += todaysProgress[id] || <span class="hljs-number">0</span>
    acc[<span class="hljs-number">1</span>] += target
    <span class="hljs-keyword">return</span> acc
  }, [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>])

  <span class="hljs-keyword">return</span> [totalProgress, totalTarget]
}</div></div></div></div></body></html>