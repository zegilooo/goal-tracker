<!DOCTYPE html><html lang="en"><head><title>containers/tracker-screen</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="containers/tracker-screen"><meta name="groc-project-path" content="src/containers/tracker-screen.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/containers/tracker-screen.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="cran-principal-conteneur">Écran principal (conteneur)</h1></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> { connect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-redux'</span>
<span class="hljs-keyword">import</span> DocumentTitle <span class="hljs-keyword">from</span> <span class="hljs-string">'react-document-title'</span>
<span class="hljs-keyword">import</span> { Link } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router'</span>
<span class="hljs-keyword">import</span> React, { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Remarquez l’injection CSS à la volée, depuis une feuille de style
Stylus, via un simple import.  C’est grâce à la combinaison de plusieurs
loaders Webpack : <code>stylus-loader</code>, pour transformer Stylus en CSS classique,
<code>css-loader</code>, qui transforme la CSS en module JS avec exports des règles, et
<code>style-loader</code>, qui va injecter ces règles à la volée dans le DOM, sur les
éléments concernés, garantissant leur application quel que soit le contexte.</p>
<p>En mode production, hjs-webpack configure le <code>ExtractTextPlugin</code> pour sortir toutes
les CSS issues de feuilles autonomes en un seul fichier CSS optimisé, pour permettre
l’application de styles dès le chargement, sans attendre que JS s’exécute.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">import</span> <span class="hljs-string">'../styles/tracker-screen.styl'</span>

<span class="hljs-keyword">import</span> { Card, CardActions, CardText, CardTitle } <span class="hljs-keyword">from</span> <span class="hljs-string">'material-ui/Card'</span>
<span class="hljs-keyword">import</span> HistoryIcon <span class="hljs-keyword">from</span> <span class="hljs-string">'material-ui/svg-icons/action/history'</span>
<span class="hljs-keyword">import</span> RaisedButton <span class="hljs-keyword">from</span> <span class="hljs-string">'material-ui/RaisedButton'</span>
<span class="hljs-keyword">import</span> SettingsIcon <span class="hljs-keyword">from</span> <span class="hljs-string">'material-ui/svg-icons/action/settings'</span>

<span class="hljs-keyword">import</span> { formatDate, getDayCounts } <span class="hljs-keyword">from</span> <span class="hljs-string">'../lib/helpers'</span>
<span class="hljs-keyword">import</span> Gauge <span class="hljs-keyword">from</span> <span class="hljs-string">'../components/gauge'</span>
<span class="hljs-keyword">import</span> GoalTrackerWidget <span class="hljs-keyword">from</span> <span class="hljs-string">'../components/goal-tracker-widget'</span>
<span class="hljs-keyword">import</span> { progressOnGoal } <span class="hljs-keyword">from</span> <span class="hljs-string">'../action-creators'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="le-composant-conteneur">Le composant conteneur</h2></div></div></div><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TrackerScreen</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Petite méthode métier calculant notre pourcentage global d’accomplissement
des objectifs quotidiens.</p></div></div><div class="code"><div class="wrapper">  overallProgress () {
    <span class="hljs-keyword">const</span> { todaysProgress, goals } = <span class="hljs-keyword">this</span>.props
    <span class="hljs-keyword">const</span> [totalProgress, totalTarget] = getDayCounts(todaysProgress, goals)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Évitons le cas où les objectifs auraient tous une cible à zéro, qui causerait
un progrès de <code>+Infinity</code>…</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">return</span> totalTarget === <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : <span class="hljs-built_in">Math</span>.floor(totalProgress * <span class="hljs-number">100</span> / totalTarget)
  }

  render () {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Décidément, la déstructuration est notre amie…</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">const</span> { goals, today, todaysProgress, dispatch } = <span class="hljs-keyword">this</span>.props
    <span class="hljs-keyword">return</span> (</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Enrobage par un
<a href="https://github.com/gaearon/react-document-title"><code>&lt;DocumentTitle&gt;</code></a>
pour modifier automatiquement le titre de la fenêtre lorsqu’on affiche
ce composant conteneur.</p></div></div><div class="code"><div class="wrapper">      &lt;DocumentTitle title=<span class="hljs-string">'Mes objectifs du jour'</span>&gt;
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">Card</span> <span class="hljs-attribute">className</span>=<span class="hljs-value">'goalTracker'</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">CardTitle</span>
            <span class="hljs-attribute">title</span>=<span class="hljs-value">{formatDate(today,</span> '<span class="hljs-attribute">LL</span>')}
            <span class="hljs-attribute">subtitle</span>=<span class="hljs-value">{&lt;Gauge</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">{this.overallProgress()}</span> /&gt;</span>}
          /&gt;
          <span class="hljs-tag">&lt;<span class="hljs-title">CardText</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">table</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-title">tbody</span>&gt;</span>
                {
                  goals.map((goal) =&gt; {
                    const progress = todaysProgress[goal.id] || 0
                    return (
                      <span class="hljs-tag">&lt;<span class="hljs-title">GoalTrackerWidget</span>
                        <span class="hljs-attribute">key</span>=<span class="hljs-value">{goal.id}</span>
                        <span class="hljs-attribute">goal</span>=<span class="hljs-value">{goal}</span>
                        <span class="hljs-attribute">progress</span>=<span class="hljs-value">{progress}</span>
                        <span class="hljs-attribute">onProgress</span>=<span class="hljs-value">{()</span> =&gt;</span> dispatch(progressOnGoal(goal.id))}
                      /&gt;
                    )</span>
                  })
                }
              &lt;<span class="hljs-regexp">/tbody&gt;
            &lt;/</span>table&gt;
          <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title">CardText</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-title">CardActions</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">RaisedButton</span> <span class="hljs-attribute">label</span>=<span class="hljs-value">'Historique'</span> <span class="hljs-attribute">secondary</span>
              <span class="hljs-attribute">icon</span>=<span class="hljs-value">{&lt;HistoryIcon</span> /&gt;</span>} linkButton containerElement={<span class="hljs-tag">&lt;<span class="hljs-title">Link</span> <span class="hljs-attribute">to</span>=<span class="hljs-value">'/history'</span> /&gt;</span>}
            /&gt;
            <span class="hljs-tag">&lt;<span class="hljs-title">RaisedButton</span> <span class="hljs-attribute">label</span>=<span class="hljs-value">'Paramètres'</span>
              <span class="hljs-attribute">icon</span>=<span class="hljs-value">{&lt;SettingsIcon</span> /&gt;</span>} linkButton containerElement={<span class="hljs-tag">&lt;<span class="hljs-title">Link</span> <span class="hljs-attribute">to</span>=<span class="hljs-value">'/settings'</span> /&gt;</span>}
            /&gt;
          <span class="hljs-tag">&lt;/<span class="hljs-title">CardActions</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">Card</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">DocumentTitle</span>&gt;</span>
    )</span>
  }
}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>On s’intéresse uniquement aux champs <code>goals</code>, <code>today</code> et <code>todaysProgress</code> de l’état
global, qu’on veut retrouver dans nos propriétés sous les mêmes noms.  Par ricochet,
seuls les changements apportés à ces champs entraîneront un éventuel <em>re-render</em>
de notre conteneur.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">const</span> mapStateToPops = ({ goals, today, todaysProgress }) =&gt; ({ goals, today, todaysProgress })</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>C’est <a href="https://github.com/reactjs/react-redux/blob/master/docs/api.md#connectmapstatetoprops-mapdispatchtoprops-mergeprops-options"><code>connect(…)</code></a>,
fourni par Redux, qui fait les connexions nécessaires pour nous
fournir les propriétés, implémenter notre <code>shouldComponentUpdate(…)</code> et nous fournir
aussi une propriété <code>dispatch(…)</code>, pré-associée au <em>store</em> Redux transmis via le
contexte React.</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> connect(mapStateToPops)(TrackerScreen)</div></div></div></div></body></html>